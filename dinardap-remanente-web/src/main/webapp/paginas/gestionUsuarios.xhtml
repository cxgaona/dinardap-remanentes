<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui">    
    <ui:composition template="/template/general.xhtml">
        <ui:define name="content">        
            <h1 class="h-wai">#{etiquetas['nombre.sistema']} - #{gestionUsuariosCtrl.tituloPagina}</h1>
            <h:form id="formUsuario">
                <p:remoteCommand name="onSelectRowUsuario" 
                                 update="formUsuarioSelected"/>
                <b:panel title="Usuarios">
                    <h:panelGrid columns="1" style="width: 100%;">
                        <p:dataTable id="usuarioTbl"
                                     value="#{gestionUsuariosCtrl.usuarioActivoList}" 
                                     var="usuario"
                                     rowKey="#{usuario.usuarioId}"
                                     selectionMode="single"
                                     selection="#{gestionUsuariosCtrl.usuarioSelected}"
                                     reflow="true" rows="10" paginator="true"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,25">
                            <p:ajax event="rowSelect" listener="#{gestionUsuariosCtrl.onRowSelectUsuario}" update="formUsuarioSelected"/>
                            <p:column headerText="ID Usuario" rendered="false">
                                <h:outputText value="#{usuario.usuarioId}"/>
                            </p:column>
                            <p:column headerText="Nombre" sortBy="#{usuario.nombre}" filterBy="#{usuario.nombre}" filterMatchMode="contains">
                                <h:outputText value="#{usuario.nombre}" />
                            </p:column>
                            <p:column headerText="Institución" sortBy="#{usuario.institucionId.nombre}" filterBy="#{usuario.institucionId.nombre}" filterMatchMode="contains">
                                <h:outputText value="#{usuario.institucionId.nombre}" />
                            </p:column>
                            <p:column headerText="Tipo Institución" 
                                      sortBy="#{usuario.institucionId.tipo eq 'REGIONAL'?'Dirección Regional':usuario.institucionId.tipo eq 'GAD'?' Gobierno Autónomo Descentralizado':'Registro Propiedad / Mercantil'}" 
                                      filterBy="#{usuario.institucionId.tipo eq 'REGIONAL'?'Dirección Regional':usuario.institucionId.tipo eq 'GAD'?' Gobierno Autónomo Descentralizado':'Registro Propiedad / Mercantil'}" 
                                      filterMatchMode="contains">
                                <h:outputText value="#{usuario.institucionId.tipo eq 'REGIONAL'?'Dirección Regional':usuario.institucionId.tipo eq 'GAD'?' Gobierno Autónomo Descentralizado':'Registro Propiedad / Mercantil'}" />
                            </p:column>
                            <p:column headerText="Login" sortBy="#{usuario.usuario}" filterBy="#{usuario.usuario}" filterMatchMode="contains">
                                <h:outputText value="#{usuario.usuario}" />
                            </p:column>
                            <p:column headerText="Contraseña" sortBy="#{usuario.contrasena}" filterBy="#{usuario.contrasena}" filterMatchMode="contains" rendered="false">
                                <h:outputText value="#{usuario.contrasena}" />
                            </p:column>
                            <p:column headerText="Registrador" sortBy="#{usuario.registrador}" width="10%">
                                <p:selectBooleanCheckbox value="#{usuario.registrador}" disabled="true" />
                            </p:column>                            
                            <p:column headerText="Validador" sortBy="#{usuario.validador}" width="10%">
                                <p:selectBooleanCheckbox value="#{usuario.validador}" disabled="true"/>
                            </p:column>
                            <p:column headerText="Verificador" sortBy="#{usuario.verificador}" width="10%">
                                <p:selectBooleanCheckbox value="#{usuario.verificador}" disabled="true" />
                            </p:column>
                            <p:column headerText="Administrador" sortBy="#{usuario.administrador}" width="10%">
                                <p:selectBooleanCheckbox value="#{usuario.administrador}" disabled="true" />
                            </p:column>
                        </p:dataTable>                          
                    </h:panelGrid>
                    <p:commandButton value="Nuevo Usuario"
                                     style="margin-right:20px;" 
                                     action="#{gestionUsuariosCtrl.nuevoUsuario}"
                                     icon="fa fa-fw fa-plus-square"
                                     update="formUsuarioSelected"/>                   
                </b:panel>
            </h:form>
            <h:form id="formUsuarioSelected" >
                <b:panel style="width: 50%" rendered="#{gestionUsuariosCtrl.renderEdition}">
                    <b:panelGrid colSpans="3,9" style="width: 100%; margin: 4px 5px;" styleClass="panel_boost">
                        <p:outputLabel for="tipoInstitucion" value="Tipo Institución:" />
                        <p:selectOneMenu id="tipoInstitucion" 
                                         value="#{gestionUsuariosCtrl.tipoInstitucion}"
                                         style="width: 70%;"
                                         required="true">
                            <p:ajax listener="#{gestionUsuariosCtrl.seleccionarTipoInstitucion}" update="formUsuarioSelected"/>
                            <f:selectItem itemLabel="Dirección Regional" itemValue="Dirección Regional" />
                            <f:selectItem itemLabel="GAD" itemValue="GAD" />
                            <f:selectItem itemLabel="Registro Propiedad / Mercantil" itemValue="Registro Propiedad / Mercantil" />
                        </p:selectOneMenu>

                        <p:outputLabel for="institucion" value="Institución:" />
                        <p:autoComplete id="institucion" 
                                        value="#{gestionUsuariosCtrl.usuarioSelected.institucionId}" 
                                        completeMethod="#{gestionUsuariosCtrl.completeNombreInstitucion}"                                        
                                        converter="#{institucionConverter}"
                                        var="institucion"
                                        itemLabel="#{institucion.nombre}"
                                        itemValue="#{institucion}"
                                        style="width: 100%" 
                                        inputStyle="width: 90%"
                                        maxResults="5"
                                        required="true"/>

                        <p:outputLabel for="usuario" value="Usuario:" />
                        <p:inputText id="usuario" value="#{gestionUsuariosCtrl.usuarioSelected.usuario}" style="width: 90%" required="true" maxlength="10">
                            <p:keyFilter regEx="/[\d]/"/>
                        </p:inputText>

                        <p:outputLabel for="nombre" value="Nombre:" />
                        <p:inputText id="nombre" value="#{gestionUsuariosCtrl.usuarioSelected.nombre}" style="width: 90%" required="true"/>

                        <h:outputLabel for="correo" value="Email: " />
                        <p:inputText id="correo" value="#{gestionUsuariosCtrl.usuarioSelected.email}" style="width: 90%" />
                        <h:outputLabel for="correo1" value="Email: " />
                        <p:inputText id="correo1" value="#{gestionUsuariosCtrl.usuarioSelected.email}" style="width: 90%" required="true"/>

                        <p:outputLabel for="contrasena" value="Contraseña:" />
                        <p:password id="contrasena" value="#{gestionUsuariosCtrl.usuarioSelected.contrasena}" 
                                    feedback="true"
                                    promptLabel="Ingrese la contraseña" weakLabel="Baja"
                                    goodLabel="Media" strongLabel="Alta" required="true"/>

                        <p:outputLabel value="Perfil:" />
                        <h:panelGrid columns="1" style="margin-bottom:10px" cellpadding="5">
                            <p:selectBooleanCheckbox value="#{gestionUsuariosCtrl.usuarioSelected.registrador}" itemLabel="Registrador"/>
                            <p:selectBooleanCheckbox value="#{gestionUsuariosCtrl.usuarioSelected.validador}" itemLabel="Validador"/>
                            <p:selectBooleanCheckbox value="#{gestionUsuariosCtrl.usuarioSelected.verificador}" itemLabel="Verificador"/>
                            <p:selectBooleanCheckbox value="#{gestionUsuariosCtrl.usuarioSelected.administrador}" itemLabel="Administrador"/>
                        </h:panelGrid>
                    </b:panelGrid>    
                    <b:panelGrid colSpans="6,6" style="width: 100%; margin: 4px 5px; text-align: center;">                        
                        <p:commandButton value="#{gestionUsuariosCtrl.btnGuardar}" id="guardarBtn" style="margin-right:20px;" icon="fa fa-fw fa-save" action="#{gestionUsuariosCtrl.guardar}" update="formUsuarioSelected, formUsuario"/>
                        <p:commandButton value="Cancelar" id="cancelarBtn" style="margin-right:20px;" icon="fa fa-fw fa-ban" action="#{gestionUsuariosCtrl.cancelar}" update="formUsuarioSelected, formUsuario"/>
                    </b:panelGrid>
                </b:panel>
            </h:form>
        </ui:define>
    </ui:composition>
</html>
